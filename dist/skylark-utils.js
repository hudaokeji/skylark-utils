/**
 * skylark-utils - An Elegant HTML5 JavaScript Library.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.5
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(t,e){function r(t,e){if("."!==t[0])return t;var r=e.split("/"),i=t.split("/");r.pop();for(var n=0;n<i.length;n++)"."!=i[n]&&(".."==i[n]?r.pop():r.push(i[n]));return r.join("/")}var i=e.define,n=e.require,s="function"==typeof i&&i.amd,a=!s&&"undefined"!=typeof exports;if(!s&&!i){var o={};i=e.define=function(t,e,i){"function"==typeof i?(o[t]={factory:i,deps:e.map(function(e){return r(e,t)}),exports:null},n(t)):o[t]=i},n=e.require=function(t){if(!o.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var r=o[t];if(!r.exports){var i=[];r.deps.forEach(function(t){i.push(n(t))}),r.exports=r.factory.apply(e,i)}return r.exports}}if(!i)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(t(i,n),!s){var u=n("skylark-langx/skylark");a?module.exports=u:e.skylarkjs=u}}(function(t,e){t("skylark-utils/skylark",["skylark-langx/skylark"],function(t){return t}),t("skylark-utils/browser",["skylark-utils-dom/browser"],function(t){return t}),t("skylark-utils/css",["skylark-utils-dom/css"],function(t){return t}),t("skylark-utils/datax",["skylark-utils-dom/datax"],function(t){return t}),t("skylark-utils/langx",["skylark-langx/langx"],function(t){return t}),t("skylark-utils/noder",["skylark-utils-dom/noder"],function(t){return t}),t("skylark-utils/finder",["skylark-utils-dom/finder"],function(t){return t}),t("skylark-utils/geom",["skylark-utils-dom/geom"],function(t){return t}),t("skylark-utils/eventer",["skylark-utils-dom/eventer"],function(t){return t}),t("skylark-utils/styler",["./skylark","./langx"],function(t,e){function r(t,e){return"number"!=typeof e||y[m(t)]?e:e+"px"}function i(t){return t in _?_[t]:_[t]=new RegExp("(^|\\s)"+t+"(\\s|$)")}function n(t,e){var r=t.className||"",i=r&&void 0!==r.baseVal;return void 0===e?i?r.baseVal:r:void(i?r.baseVal=e:t.className=e)}function s(t,e){return arguments.length<2?!!this.dom.disabled:(t.disabled=e,this)}function a(t){var e,r;return k[t]||(e=document.createElement(t),document.body.appendChild(e),r=getComputedStyle(e,"").getPropertyValue("display"),e.parentNode.removeChild(e),"none"==r&&(r="block"),k[t]=r),k[t]}function o(t){return E.css(t,"display",""),"none"==E.css(t,"display")&&E.css(t,"display",a(t.nodeName)),this}function u(t){return"none"==E.css(t,"display")||0==E.css(t,"opacity")}function l(t){return E.css(t,"display","none"),this}function c(t,r){if(!r)return this;var s,a=n(t);return s=e.isString(r)?r.split(/\s+/g):r,s.forEach(function(t){var e=i(t);a.match(e)||(a+=(a?" ":"")+t)}),n(t,a),this}function d(t,i,n){if(arguments.length<3){var s,s=getComputedStyle(t,"");if(e.isString(i))return t.style[v(i)]||s.getPropertyValue(m(i));if(e.isArrayLike(i)){var a={};return p.call(i,function(e){a[e]=t.style[v(e)]||s.getPropertyValue(m(e))}),a}}var o="";if("string"==typeof i)n||0===n?o=m(i)+":"+r(i,n):t.style.removeProperty(m(i));else for(key in i)void 0!==i[key]&&(i[key]||0===i[key]?o+=m(key)+":"+r(key,i[key])+";":t.style.removeProperty(m(key)));return t.style.cssText+=";"+o,this}function h(t,e){var r=i(e);return t.className&&t.className.match(r)}function f(t,r){if(r){var s,a=n(t);s=e.isString(r)?r.split(/\s+/g):r,s.forEach(function(t){var e=i(t);a.match(e)&&(a=a.replace(e," "))}),n(t,a.trim())}else n(t,"");return this}function g(t,e,r){var i=this;return e.split(/\s+/g).forEach(function(e){void 0===r&&(r=!i.hasClass(t,e)),r?i.addClass(t,e):i.removeClass(t,e)}),i}var p=(Array.prototype.every,Array.prototype.forEach),v=e.camelCase,m=e.dasherize,y={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},_={},k={},E=function(){return E};return e.mixin(E,{autocssfix:!1,cssHooks:{},addClass:c,className:n,css:d,disabled:s,hasClass:h,hide:l,isInvisible:u,removeClass:f,show:o,toggleClass:g}),t.styler=E}),t("skylark-utils/dnd",["./skylark","./langx","./noder","./datax","./finder","./geom","./eventer","./styler"],function(t,e,r,i,n,s,a,o){function u(t,e){return new f(t,e)}function l(t,e){return new g(t,e)}function c(){return c}var d=(a.on,a.off,i.attr,i.removeAttr,s.pagePosition,o.addClass,s.height,e.Evented.inherit({klassName:"DndManager",init:function(){},prepare:function(t){var e=a.create("preparing",{dragSource:t.dragSource,dragHandle:t.dragHandle});t.trigger(e),t.dragSource=e.dragSource},start:function(t,r){var i=s.pagePosition(t.dragSource);this.draggingOffsetX=parseInt(r.pageX-i.left),this.draggingOffsetY=parseInt(r.pageY-i.top);var n=a.create("started",{elm:t.elm,dragSource:t.dragSource,dragHandle:t.dragHandle,ghost:null,transfer:{}});t.trigger(n),this.dragging=t,t.draggingClass&&o.addClass(t.dragSource,t.draggingClass),this.draggingGhost=n.ghost,this.draggingGhost||(this.draggingGhost=t.elm),this.draggingTransfer=n.transfer,this.draggingTransfer&&e.each(this.draggingTransfer,function(t,e){r.dataTransfer.setData(t,e)}),r.dataTransfer.setDragImage(this.draggingGhost,this.draggingOffsetX,this.draggingOffsetY),r.dataTransfer.effectAllowed="copyMove";var u=a.create("dndStarted",{elm:n.elm,dragSource:n.dragSource,dragHandle:n.dragHandle,ghost:n.ghost,transfer:n.transfer});this.trigger(u)},over:function(){},end:function(t){var e=this.dragging;e&&e.draggingClass&&o.removeClass(e.dragSource,e.draggingClass);var r=a.create("dndEnded",{});this.trigger(r),this.dragging=null,this.draggingTransfer=null,this.draggingGhost=null,this.draggingOffsetX=null,this.draggingOffsetY=null}})),h=new d,f=e.Evented.inherit({klassName:"Draggable",init:function(t,r){var s=this;s.elm=t,s.draggingClass=r.draggingClass||"dragging",s.params=e.clone(r),["preparing","started","ended","moving"].forEach(function(t){e.isFunction(r[t])&&s.on(t,r[t])}),a.on(t,{mousedown:function(t){var e=s.params;e.handle&&(s.dragHandle=n.closest(t.target,e.handle),!s.dragHandle)||(e.source?s.dragSource=n.closest(t.target,e.source):s.dragSource=s.elm,h.prepare(s),s.dragSource&&i.attr(s.dragSource,"draggable","true"))},mouseup:function(t){s.dragSource&&(s.dragSource=null,s.dragHandle=null)},dragstart:function(t){i.attr(s.dragSource,"draggable","false"),h.start(s,t)},dragend:function(t){a.stop(t),h.dragging&&h.end(!1)}})}}),g=e.Evented.inherit({klassName:"Droppable",init:function(t,r){var i,n,s=this,u=(r.draggingClass||"dragging",!0);s.elm=t,s._params=r,["started","entered","leaved","dropped","overing"].forEach(function(t){e.isFunction(r[t])&&s.on(t,r[t])}),a.on(t,{dragover:function(t){if(t.stopPropagation(),u){var e=a.create("overing",{overElm:t.target,transfer:h.draggingTransfer,acceptable:!0});s.trigger(e),e.acceptable&&(t.preventDefault(),t.dataTransfer.dropEffect="copyMove")}},dragenter:function(t){var e=(s._params,s.elm),r=a.create("entered",{transfer:h.draggingTransfer});s.trigger(r),t.stopPropagation(),i&&u&&o.addClass(e,i)},dragleave:function(t){var e=(s._params,s.elm);if(!u)return!1;var r=a.create("leaved",{transfer:h.draggingTransfer});s.trigger(r),t.stopPropagation(),i&&u&&o.removeClass(e,i)},drop:function(t){var e=(s._params,s.elm);if(a.stop(t),h.dragging){i&&u&&o.addClass(e,i);var r=a.create("dropped",{transfer:h.draggingTransfer});s.trigger(r),h.end(!0)}}}),h.on("dndStarted",function(e){var r=a.create("started",{transfer:h.draggingTransfer,acceptable:!1});s.trigger(r),u=r.acceptable,i=r.hoverClass,n=r.activeClass,n&&u&&o.addClass(t,n)}).on("dndEnded",function(e){var r=a.create("ended",{transfer:h.draggingTransfer,acceptable:!1});s.trigger(r),i&&u&&o.removeClass(t,i),n&&u&&o.removeClass(t,n),u=!1,n=null,i=null})}});return e.mixin(c,{draggable:u,droppable:l,manager:h}),t.dnd=c}),t("skylark-utils/_devices/usermedia",["../langx"],function(t){function e(){return e}navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var r=t.Deferred,i=null;return t.mixin(e,{isSupported:function(){return!!navigator.getUserMedia},start:function(t,e){var n=new r;return navigator.getUserMedia({video:!0,audio:!0},function(e){i=e,t.src=window.URL.createObjectURL(localMediaStream),t.onloadedmetadata=function(t){},n.resolve()},function(t){n.reject(t)}),n.promise},stop:function(){i&&(i.stop(),i=null)}}),e}),t("skylark-utils/_devices/vibrate",["../langx"],function(t){function e(){return e}return navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,t.mixin(e,{isSupported:function(){return!!navigator.vibrate},start:function(t){navigator.vibrate(t)},stop:function(){navigator.vibrate(0)}}),e}),t("skylark-utils/devices",["./skylark","./langx","./_devices/usermedia","./_devices/vibrate"],function(t,e,r,i){function n(){return n}return e.mixin(n,{usermedia:r,vibrate:i}),t.devices=n}),t("skylark-utils/filer",["skylark-utils-filer/filer"],function(t){return t}),t("skylark-utils/fx",["skylark-utils-dom/fx"],function(t){return t}),t("skylark-utils/images",["skylark-utils-dom/images"],function(t){return t}),t("skylark-utils/models",["./skylark","./langx"],function(t,e){function r(){return r}var i={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"},n=function(t,n,s){var a=i[t];e.defaults(s||(s={}),{emulateHTTP:r.emulateHTTP,emulateJSON:r.emulateJSON});var o={type:a,dataType:"json"};if(s.url||(o.url=e.result(n,"url")||urlError()),null!=s.data||!n||"create"!==t&&"update"!==t&&"patch"!==t||(o.contentType="application/json",o.data=JSON.stringify(s.attrs||n.toJSON(s))),s.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{entity:o.data}:{}),s.emulateHTTP&&("PUT"===a||"DELETE"===a||"PATCH"===a)){o.type="POST",s.emulateJSON&&(o.data._method=a);var u=s.beforeSend;s.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",a),u)return u.apply(this,arguments)}}"GET"===o.type||s.emulateJSON||(o.processData=!1);var l=s.error;s.error=function(t,e,r){s.textStatus=e,s.errorThrown=r,l&&l.call(s.context,t,e,r)};var c=s.xhr=e.Xhr.request(e.mixin(o,s));return n.trigger("request",n,c,s),c},s=e.Stateful.inherit({sync:function(){return r.sync.apply(this,arguments)},matches:function(t){return e.isMatch(this.attributes,t)},fetch:function(t){t=e.mixin({parse:!0},t);var r=this,i=t.success;return t.success=function(e){var n=t.parse?r.parse(e,t):e;return!!r.set(n,t)&&(i&&i.call(t.context,r,e,t),void r.trigger("sync",r,e,t))},wrapError(this,t),this.sync("read",this,t)},save:function(t,r,i){var n;null==t||"object"==typeof t?(n=t,i=r):(n={})[t]=r,i=e.mixin({validate:!0,parse:!0},i);var s=i.wait;if(n&&!s){if(!this.set(n,i))return!1}else if(!this._validate(n,i))return!1;var a=this,o=i.success,u=this.attributes;i.success=function(t){a.attributes=u;var r=i.parse?a.parse(t,i):t;return s&&(r=e.mixin({},n,r)),!(r&&!a.set(r,i))&&(o&&o.call(i.context,a,t,i),void a.trigger("sync",a,t,i))},wrapError(this,i),n&&s&&(this.attributes=e.mixin({},u,n));var l=this.isNew()?"create":i.patch?"patch":"update";"patch"!==l||i.attrs||(i.attrs=n);var c=this.sync(l,this,i);return this.attributes=u,c},destroy:function(t){t=t?e.clone(t):{};var r=this,i=t.success,n=t.wait,s=function(){r.stopListening(),r.trigger("destroy",r,r.collection,t)};t.success=function(e){n&&s(),i&&i.call(t.context,r,e,t),r.isNew()||r.trigger("sync",r,e,t)};var a=!1;return this.isNew()?e.defer(t.success):(wrapError(this,t),a=this.sync("delete",this,t)),n||s(),a},url:function(){var t=e.result(this,"urlRoot")||e.result(this.collection,"url")||urlError();if(this.isNew())return t;var r=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(r)},parse:function(t,e){return t}}),a=e.Evented.inherit({init:function(t,r){r||(r={}),r.entity&&(this.entity=r.entity),void 0!==r.comparator&&(this.comparator=r.comparator),this._reset(),t&&this.reset(t,e.mixin({silent:!0},r))}}),o={add:!0,remove:!0,merge:!0},u={add:!0,remove:!1},l=function(t,e,r){r=Math.min(Math.max(r,0),t.length);var i,n=Array(t.length-r),s=e.length;for(i=0;i<n.length;i++)n[i]=t[i+r];for(i=0;i<s;i++)t[i+r]=e[i];for(i=0;i<n.length;i++)t[i+s+r]=n[i]};return a.partial({entity:s,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return r.sync.apply(this,arguments)},add:function(t,r){return this.set(t,e.mixin({merge:!1},r,u))},remove:function(t,r){r=e.mixin({},r);var i=!e.isArray(t);t=i?[t]:t.slice();var n=this._removeEntitys(t,r);return!r.silent&&n.length&&(r.changes={added:[],merged:[],removed:n},this.trigger("update",this,r)),i?n[0]:n},set:function(t,r){if(null!=t){r=e.mixin({},o,r),r.parse&&!this._isEntity(t)&&(t=this.parse(t,r)||[]);var i=!e.isArray(t);t=i?[t]:t.slice();var n=r.at;null!=n&&(n=+n),n>this.length&&(n=this.length),n<0&&(n+=this.length+1);var s,a,u=[],c=[],d=[],h=[],f={},g=r.add,p=r.merge,v=r.remove,m=!1,y=this.comparator&&null==n&&r.sort!==!1,_=e.isString(this.comparator)?this.comparator:null;for(a=0;a<t.length;a++){s=t[a];var k=this.get(s);if(k){if(p&&s!==k){var E=this._isEntity(s)?s.attributes:s;r.parse&&(E=k.parse(E,r)),k.set(E,r),d.push(k),y&&!m&&(m=k.hasChanged(_))}f[k.cid]||(f[k.cid]=!0,u.push(k)),t[a]=k}else g&&(s=t[a]=this._prepareEntity(s,r),s&&(c.push(s),this._addReference(s,r),f[s.cid]=!0,u.push(s)))}if(v){for(a=0;a<this.length;a++)s=this.entities[a],f[s.cid]||h.push(s);h.length&&this._removeEntitys(h,r)}var w=!1,b=!y&&g&&v;if(u.length&&b?(w=this.length!==u.length||this.entities.some(function(t,e){return t!==u[e]}),this.entities.length=0,l(this.entities,u,0),this.length=this.entities.length):c.length&&(y&&(m=!0),l(this.entities,c,null==n?this.length:n),this.length=this.entities.length),m&&this.sort({silent:!0}),!r.silent){for(a=0;a<c.length;a++)null!=n&&(r.index=n+a),s=c[a],s.trigger("add",s,this,r);(m||w)&&this.trigger("sort",this,r),(c.length||h.length||d.length)&&(r.changes={added:c,removed:h,merged:d},this.trigger("update",this,r))}return i?t[0]:t}},reset:function(t,r){r=r?e.clone(r):{};for(var i=0;i<this.entities.length;i++)this._removeReference(this.entities[i],r);return r.previousEntitys=this.entities,this._reset(),t=this.add(t,e.mixin({silent:!0},r)),r.silent||this.trigger("reset",this,r),t},push:function(t,r){return this.add(t,e.mixin({at:this.length},r))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,r){return this.add(t,e.mixin({at:0},r))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return slice.apply(this.entities,arguments)},get:function(t){if(null!=t)return this._byId[t]||this._byId[this.entityId(t.attributes||t)]||t.cid&&this._byId[t.cid]},has:function(t){return null!=this.get(t)},at:function(t){return t<0&&(t+=this.length),this.entities[t]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,!0)},sort:function(t){var r=this.comparator;if(!r)throw new Error("Cannot sort a set without a comparator");t||(t={});var i=r.length;return e.isFunction(r)&&(r=e.proxy(r,this)),1===i||e.isString(r)?this.entities=this.sortBy(r):this.entities.sort(r),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return this.map(t+"")},fetch:function(t){t=e.mixin({parse:!0},t);var r=t.success,i=this;return t.success=function(e){var n=t.reset?"reset":"set";i[n](e,t),r&&r.call(t.context,i,e,t),i.trigger("sync",i,e,t)},wrapError(this,t),this.sync("read",this,t)},create:function(t,r){r=r?e.clone(r):{};var i=r.wait;if(t=this._prepareEntity(t,r),!t)return!1;i||this.add(t,r);var n=this,s=r.success;return r.success=function(t,e,r){i&&n.add(t,r),s&&s.call(r.context,t,e,r)},t.save(null,r),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.entities,{entity:this.entity,comparator:this.comparator})},entityId:function(t){return t[this.entity.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.entities=[],this._byId={}},_prepareEntity:function(t,r){if(this._isEntity(t))return t.collection||(t.collection=this),t;r=r?e.clone(r):{},r.collection=this;var i=new this.entity(t,r);return i.validationError?(this.trigger("invalid",this,i.validationError,r),!1):i},_removeEntitys:function(t,e){for(var r=[],i=0;i<t.length;i++){var n=this.get(t[i]);if(n){var s=this.indexOf(n);this.entities.splice(s,1),this.length--,delete this._byId[n.cid];var a=this.entityId(n.attributes);null!=a&&delete this._byId[a],e.silent||(e.index=s,n.trigger("remove",n,this,e)),r.push(n),this._removeReference(n,e)}}return r},_isEntity:function(t){return t instanceof s},_addReference:function(t,e){this._byId[t.cid]=t;var r=this.entityId(t.attributes);null!=r&&(this._byId[r]=t),t.on("all",this._onEntityEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var r=this.entityId(t.attributes);null!=r&&delete this._byId[r],this===t.collection&&delete t.collection,t.off("all",this._onEntityEvent,this)},_onEntityEvent:function(t,e,r,i){if(e){if(("add"===t||"remove"===t)&&r!==this)return;if("destroy"===t&&this.remove(e,i),"change"===t){var n=this.entityId(e.previousAttributes()),s=this.entityId(e.attributes);n!==s&&(null!=n&&delete this._byId[n],null!=s&&(this._byId[s]=e))}}this.trigger.apply(this,arguments)}}),e.mixin(r,{emulateHTTP:!1,emulateJSON:!1,sync:n,Entity:s,Collection:a}),t.models=r}),t("skylark-utils/query",["skylark-utils-dom/query"],function(t){return t}),t("skylark-utils/scripter",["skylark-utils-dom/scripter"],function(t){return t}),t("skylark-utils/_storages/cookies",["../langx"],function(t){function e(){return e}return t.mixin(e,{get:function(t){return sKey&&this.has(t)?unescape(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1")):null},has:function(t){return new RegExp("(?:^|;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},list:function(){for(var t=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),e=0;e<t.length;e++)t[e]=unescape(t[e]);return t},remove:function(t,e){t&&this.has(t)&&(document.cookie=escape(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(e?"; path="+e:""))},set:function(t,e,r,i,n,s){if(t&&!/^(?:expires|max\-age|path|domain|secure)$/i.test(t)){var a="";if(r)switch(r.constructor){case Number:a=vEnd===1/0?"; expires=Tue, 19 Jan 2038 03:14:07 GMT":"; max-age="+r;break;case String:a="; expires="+r;break;case Date:a="; expires="+r.toGMTString()}document.cookie=escape(t)+"="+escape(e)+a+(n?"; domain="+n:"")+(i?"; path="+i:"")+(s?"; secure":"")}}}),e}),t("skylark-utils/_storages/localfs",["../langx"],function(t){function e(t){var e="";switch(t.code){case FileError.QUOTA_EXCEEDED_ERR:e="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:e="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:e="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:e="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:e="INVALID_STATE_ERR";break;default:e="Unknown Error"}return e}function r(){return r}var i=t.Deferred,n=window.requestFileSystem||window.webkitRequestFileSystem,s=(window.resolveLocalFileSystemURL||window.webkitResolveLocalFileSystemURL,window.MozBlobBuilder||window.WebKitBlobBuilder||window.BlobBuilder,t.Evented.inherit({_fs:null,_isPersisted:!0,_cwd:null,init:function(t){this._fs=t,this._cwd=t.root},readfileAsArrayBuffer:function(t,e,r){this._cwd.getFile(t,{},function(t){t.file(function(t){var r=new FileReader;r.onloadend=function(){e(null,this.result)},r.readAsArrayBuffer(t)},r)},r)},readfileAsDataURL:function(t,e,r){this._cwd.getFile(t,{},function(t){t.file(function(t){var r=new FileReader;r.onloadend=function(){e(null,this.result)},r.readAsDataURL(t)},r)},r)},readfileAsText:function(t,e,r){this._cwd.getFile(t,{},function(t){t.file(function(t){var r=new FileReader;r.onloadend=function(){e(null,this.result)},r.readAsText(t)},r)},r)},writefile:function(t,e,r,i){var n=this,s=t.split("/");s=s.slice(0,s.length-1),this.mkdir(s.join("/"),function(){n._cwd.getFile(t,{create:!0},function(t){t.createWriter(function(t){var n=!1;t.onwriteend=function(){return n?void(r&&r()):(n=!0,void this.truncate(this.position))},t.onerror=i;var s=e;!s instanceof Blob&&(s=new Blob([e],{type:"text/plain"})),t.write(s)},i)},i)})},rmfile:function(t,e,r){this._cwd.getFile(t,{},function(t){t.remove(function(){e()},r)},r)},readdir:function(t,e,r){this._cwd.getDirectory(t,{},function(t){function i(){n.readEntries(function(t){t.length?(s=s.concat(Array.prototype.slice.call(t).map(function(t){return t.name+(t.isDirectory?"/":"")})),i()):e(null,s)},r)}var n=t.createReader(),s=[];i()},r)},mkdir:function(t,e,r){var i=t.split("/"),n=function(s,a){return"."!=a[0]&&""!=a[0]||(a=a.slice(1)),0==a.length?void e(s):void s.getDirectory(a[0],{create:!0,exclusive:!1},function(s){if(s.isDirectory)a.length&&1!=i.length?n(s,a.slice(1)):e&&e(s);else{var o=new Error(t+" is not a directory");if(!r)throw o;r(o)}},function(t){if(!r)throw t;r(t)})};n(this._cwd,i)},rmdir:function(t,e,r){this._cwd.getDirectory(t,{},function(t){t.removeRecursively(function(){e()},r)},r)},copy:function(t,e,r){this._cwd.getFile(t,{},function(t){cwd.getDirectory(e,{},function(e){t.copyTo(e,function(){r()},r)},r)},r)},move:function(t,e,r){this._cwd.getFile(t,{},function(t){cwd.getDirectory(e,{},function(e){t.moveTo(e,function(){r()},r)},r)},r)},chdir:function(t,e){this._cwd.getDirectory(t,{},function(t){cwd=t,fs.onchdir&&fs.onchdir(cwd.fullPath),e()},e)},importFromHost:function(t){for(var r,n=new i,s=0;r=t[s];++s)!function(t){cwd.getFile(r.name,{create:!0,exclusive:!0},function(r){r.createWriter(function(e){e.write(t)},e)},e)}(r);return n.promise},exportToHost:function(){}}));return t.mixin(r,{isSupported:function(){return!!n},request:function(t,e){t=t||10485760;var r=e?PERSISTENT:TEMPORARY,a=new i;return n(r,t,function(t){var r=new s(t,(!!e));a.resolve(r)},function(t){a.reject(t)}),a.promise},FileSystem:s}),r}),t("skylark-utils/_storages/localStorage",["../langx"],function(t){function e(){return e}var r=null;try{r=window.localStorage}catch(i){}return t.mixin(e,{isSupported:function(){return!!r},set:function(e,i){return void 0===i?this.remove(e):(r.setItem(e,t.serializeValue(i)),i)},get:function(e,i){var n=t.deserializeValue(r.getItem(e));return void 0===n?i:n},remove:function(t){r.removeItem(t)},clear:function(){r.clear()},forEach:function(t){for(var e=0;e<r.length;e++){var i=r.key(e);t(i,store.get(i))}}}),e}),t("skylark-utils/_storages/sessionStorage",["../langx"],function(t){function e(){return e}var r=null;try{r=window.sessiionStorage}catch(i){}return t.mixin(e,{isSupported:function(){return!!r},set:function(e,i){return void 0===i?this.remove(e):(r.setItem(e,t.serializeValue(i)),i)},get:function(e,i){var n=t.deserializeValue(r.getItem(e));return void 0===n?i:n},remove:function(t){r.removeItem(t)},clear:function(){r.clear()},forEach:function(t){for(var e=0;e<r.length;e++){var i=r.key(e);t(i,store.get(i))}}}),e}),t("skylark-utils/storages",["./skylark","./langx","./_storages/cookies","./_storages/localfs","./_storages/localStorage","./_storages/sessionStorage"],function(t,e,r,i,n,s){function a(){return a}return e.mixin(a,{cookies:r,localfs:i,localStorage:n,sessionStorage:s}),t.storages=a}),t("skylark-utils/touchx",[],function(){var t=function(){function t(){this._dropEffect="move",this._effectAllowed="all",this._data={}}return Object.defineProperty(t.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(t){this._dropEffect=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"effectAllowed",{get:function(){return this._effectAllowed},set:function(t){this._effectAllowed=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"types",{get:function(){return Object.keys(this._data)},enumerable:!0,configurable:!0}),t.prototype.clearData=function(t){null!=t?delete this._data[t]:this._data=null},t.prototype.getData=function(t){return this._data[t]||""},t.prototype.setData=function(t,e){this._data[t]=e},t.prototype.setDragImage=function(t,r,i){var n=e._instance;n._imgCustom=t,n._imgOffset={x:r,y:i}},t}(),e=function(){function e(){if(this._lastClick=0,e._instance)throw"DragDropTouch instance already created.";var t=!1;if(document.addEventListener("test",null,{get passive(){return t=!0,!0}}),"ontouchstart"in document){var r=document,i=this._touchstart.bind(this),n=this._touchmove.bind(this),s=this._touchend.bind(this),a=!!t&&{passive:!1,capture:!1};r.addEventListener("touchstart",i,a),r.addEventListener("touchmove",n,a),r.addEventListener("touchend",s),r.addEventListener("touchcancel",s)}}return e.getInstance=function(){return e._instance},e.prototype._touchstart=function(t){var r=this;if(this._shouldHandle(t)){if(Date.now()-this._lastClick<e._DBLCLICK&&this._dispatchEvent(t,"dblclick",t.target))return t.preventDefault(),void this._reset();this._reset();var i=this._closestDraggable(t.target);i&&(this._dispatchEvent(t,"mousemove",t.target)||this._dispatchEvent(t,"mousedown",t.target)||(this._dragSource=i,this._ptDown=this._getPoint(t),this._lastTouch=t,t.preventDefault(),setTimeout(function(){r._dragSource==i&&null==r._img&&r._dispatchEvent(t,"contextmenu",i)&&r._reset()},e._CTXMENU)))}},e.prototype._touchmove=function(t){if(this._shouldHandle(t)){var r=this._getTarget(t);if(this._dispatchEvent(t,"mousemove",r))return this._lastTouch=t,void t.preventDefault();if(this._dragSource&&!this._img){var i=this._getDelta(t);i>e._THRESHOLD&&(this._dispatchEvent(t,"dragstart",this._dragSource),this._createImage(t),this._dispatchEvent(t,"dragenter",r))}this._img&&(this._lastTouch=t,t.preventDefault(),r!=this._lastTarget&&(this._dispatchEvent(this._lastTouch,"dragleave",this._lastTarget),this._dispatchEvent(t,"dragenter",r),this._lastTarget=r),this._moveImage(t),this._dispatchEvent(t,"dragover",r))}},e.prototype._touchend=function(t){if(this._shouldHandle(t)){if(this._dispatchEvent(this._lastTouch,"mouseup",t.target))return void t.preventDefault();this._img||(this._dragSource=null,this._dispatchEvent(this._lastTouch,"click",t.target),this._lastClick=Date.now()),this._destroyImage(),this._dragSource&&(t.type.indexOf("cancel")<0&&this._dispatchEvent(this._lastTouch,"drop",this._lastTarget),this._dispatchEvent(this._lastTouch,"dragend",this._dragSource),this._reset())}},e.prototype._shouldHandle=function(t){return t&&!t.defaultPrevented&&t.touches&&t.touches.length<2},e.prototype._reset=function(){this._destroyImage(),this._dragSource=null,this._lastTouch=null,this._lastTarget=null,this._ptDown=null,this._dataTransfer=new t},e.prototype._getPoint=function(t,e){return t&&t.touches&&(t=t.touches[0]),{x:e?t.pageX:t.clientX,y:e?t.pageY:t.clientY}},e.prototype._getDelta=function(t){var e=this._getPoint(t);return Math.abs(e.x-this._ptDown.x)+Math.abs(e.y-this._ptDown.y)},e.prototype._getTarget=function(t){for(var e=this._getPoint(t),r=document.elementFromPoint(e.x,e.y);r&&"none"==getComputedStyle(r).pointerEvents;)r=r.parentElement;return r},e.prototype._createImage=function(t){this._img&&this._destroyImage();var r=this._imgCustom||this._dragSource;if(this._img=r.cloneNode(!0),this._copyStyle(r,this._img),this._img.style.top=this._img.style.left="-9999px",!this._imgCustom){var i=r.getBoundingClientRect(),n=this._getPoint(t);this._imgOffset={x:n.x-i.left,y:n.y-i.top},this._img.style.opacity=e._OPACITY.toString()}this._moveImage(t),document.body.appendChild(this._img)},e.prototype._destroyImage=function(){this._img&&this._img.parentElement&&this._img.parentElement.removeChild(this._img),this._img=null,this._imgCustom=null},e.prototype._moveImage=function(t){var e=this;this._img&&requestAnimationFrame(function(){var r=e._getPoint(t,!0),i=e._img.style;i.position="absolute",i.pointerEvents="none",i.zIndex="999999",i.left=Math.round(r.x-e._imgOffset.x)+"px",i.top=Math.round(r.y-e._imgOffset.y)+"px"})},e.prototype._copyProps=function(t,e,r){for(var i=0;i<r.length;i++){var n=r[i];t[n]=e[n]}},e.prototype._copyStyle=function(t,r){if(e._rmvAtts.forEach(function(t){r.removeAttribute(t)}),t instanceof HTMLCanvasElement){var i=t,n=r;n.width=i.width,n.height=i.height,n.getContext("2d").drawImage(i,0,0)}for(var s=getComputedStyle(t),a=0;a<s.length;a++){var o=s[a];o.indexOf("transition")<0&&(r.style[o]=s[o])}r.style.pointerEvents="none";for(var a=0;a<t.children.length;a++)this._copyStyle(t.children[a],r.children[a])},e.prototype._dispatchEvent=function(t,r,i){if(t&&i){var n=document.createEvent("Event"),s=t.touches?t.touches[0]:t;return n.initEvent(r,!0,!0),n.button=0,n.which=n.buttons=1,this._copyProps(n,t,e._kbdProps),this._copyProps(n,s,e._ptProps),n.dataTransfer=this._dataTransfer,i.dispatchEvent(n),n.defaultPrevented}return!1},e.prototype._closestDraggable=function(t){for(;t;t=t.parentElement)if(t.hasAttribute("draggable")&&t.draggable)return t;return null},e}();return e._instance=new e,e._THRESHOLD=5,e._OPACITY=.5,e._DBLCLICK=500,e._CTXMENU=900,e._rmvAtts="id,class,style,draggable".split(","),e._kbdProps="altKey,ctrlKey,metaKey,shiftKey".split(","),e._ptProps="pageX,pageY,clientX,clientY,screenX,screenY".split(","),e}),t("skylark-utils/transforms",["skylark-utils-dom/transforms"],function(t){return t}),t("skylark-utils/elmx",["skylark-utils-dom/elmx"],function(t){return t}),t("skylark-utils/widgets",["./skylark","./langx","./noder","./datax","./styler","./geom","./eventer","./query","./elmx"],function(t,e,r,i,n,s,a,o,u){function l(){return l}function c(t,e,r){}var d=e.Evented.inherit({init:function(t,r){if(e.isHtmlNode(r)){var r=t;t=r}e.isHtmlNode(t)?this.el=t:this.el=null,r&&e.mixin(this,r),this.cid||(this.cid=e.uniqueId("w")),this._ensureElement()},tagName:"div",$:function(t){return this.$el.find(t)},render:function(){return this},remove:function(){return this._removeElement(),this.unlistenTo(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=l.$(t),this.el=this.$el[0]},delegateEvents:function(t){if(t||(t=e.result(this,"events")),!t)return this;this.undelegateEvents();for(var r in t){var i=t[r];if(e.isFunction(i)||(i=this[i]),i){var n=r.match(delegateEventSplitter);this.delegate(n[1],n[2],e.proxy(i,this))}}return this},delegate:function(t,e,r){return this.$el.on(t+".delegateEvents"+this.uid,e,r),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.uid),this},undelegate:function(t,e,r){return this.$el.off(t+".delegateEvents"+this.uid,e,r),this},_createElement:function(t,e){return r.createElement(t,e)},_ensureElement:function(){if(this.el)this.setElement(e.result(this,"el"));else{var t=e.mixin({},e.result(this,"attributes"));this.id&&(t.id=e.result(this,"id")),this.className&&(t["class"]=e.result(this,"className")),this.setElement(this._createElement(e.result(this,"tagName"),t)),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)},i18n:function(t,r){return t=this.messages&&this.messages[t]||t.toString(),r&&e.each(r,function(e,r){t=t.replace("{"+e+"}",r)}),t}});return e.mixin(l,{$:o,define:c,Widget:d}),t.widgets=l}),t("skylark-utils/main",["./skylark","./browser","./css","./datax","./dnd","./devices","./eventer","./filer","./finder","./fx","./geom","./images","./models","./noder","./query","./scripter","./storages","./styler","./touchx","./transforms","./langx","./elmx","./widgets"],function(t){return t}),t("skylark-utils",["skylark-utils/main"],function(t){return t})},this);
//# sourceMappingURL=sourcemaps/skylark-utils.js.map
