/**
 * skylark-utils - An Elegant HTML5 JavaScript Library.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.5
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(t,e){var r=e.define,i=e.require,n="function"==typeof r&&r.amd,s=!n&&"undefined"!=typeof exports;if(!n&&!r){var a={};r=e.define=function(t,e,r){"function"==typeof r?(a[t]={factory:r,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var r=e.split("/"),i=t.split("/");r.pop();for(var n=0;n<i.length;n++)"."!=i[n]&&(".."==i[n]?r.pop():r.push(i[n]));return r.join("/")}(e,t)}),exports:null},i(t)):a[t]=r},i=e.require=function(t){if(!a.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var r=a[t];if(!r.exports){var n=[];r.deps.forEach(function(t){n.push(i(t))}),r.exports=r.factory.apply(e,n)}return r.exports}}if(!r)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,e){t("skylark-utils/skylark",["skylark-langx/skylark"],function(t){return t}),t("skylark-utils/browser",["skylark-utils-dom/browser"],function(t){return t}),t("skylark-utils/css",["skylark-utils-dom/css"],function(t){return t}),t("skylark-utils/datax",["skylark-utils-dom/datax"],function(t){return t}),t("skylark-utils/langx",["skylark-langx/langx"],function(t){return t}),t("skylark-utils/noder",["skylark-utils-dom/noder"],function(t){return t}),t("skylark-utils/finder",["skylark-utils-dom/finder"],function(t){return t}),t("skylark-utils/geom",["skylark-utils-dom/geom"],function(t){return t}),t("skylark-utils/eventer",["skylark-utils-dom/eventer"],function(t){return t}),t("skylark-utils/styler",["./skylark","./langx"],function(t,e){Array.prototype.every;var r=Array.prototype.forEach,i=e.camelCase,n=e.dasherize;function s(t,e){return"number"!=typeof e||a[n(t)]?e:e+"px"}var a={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},o={};function u(t){return t in o?o[t]:o[t]=new RegExp("(^|\\s)"+t+"(\\s|$)")}function l(t,e){var r=t.className||"",i=r&&void 0!==r.baseVal;if(void 0===e)return i?r.baseVal:r;i?r.baseVal=e:t.className=e}var c={};var h=function(){return h};return e.mixin(h,{autocssfix:!1,cssHooks:{},addClass:function(t,r){if(!r)return this;var i,n=l(t);i=e.isString(r)?r.split(/\s+/g):r;return i.forEach(function(t){var e=u(t);n.match(e)||(n+=(n?" ":"")+t)}),l(t,n),this},className:l,css:function(t,a,o){if(arguments.length<3){var u=getComputedStyle(t,"");if(e.isString(a))return t.style[i(a)]||u.getPropertyValue(n(a));if(e.isArrayLike(a)){var l={};return r.call(a,function(e){l[e]=t.style[i(e)]||u.getPropertyValue(n(e))}),l}}var c="";if("string"==typeof a)o||0===o?c=n(a)+":"+s(a,o):t.style.removeProperty(n(a));else for(key in a)void 0!==a[key]&&(a[key]||0===a[key]?c+=n(key)+":"+s(key,a[key])+";":t.style.removeProperty(n(key)));return t.style.cssText+=";"+c,this},disabled:function(t,e){if(arguments.length<2)return!!this.dom.disabled;return t.disabled=e,this},hasClass:function(t,e){var r=u(e);return t.className&&t.className.match(r)},hide:function(t){return h.css(t,"display","none"),this},isInvisible:function(t){return"none"==h.css(t,"display")||0==h.css(t,"opacity")},removeClass:function(t,r){if(r){var i=l(t);(e.isString(r)?r.split(/\s+/g):r).forEach(function(t){var e=u(t);i.match(e)&&(i=i.replace(e," "))}),l(t,i.trim())}else l(t,"");return this},show:function(t){h.css(t,"display",""),"none"==h.css(t,"display")&&h.css(t,"display",function(t){var e,r;c[t]||(e=document.createElement(t),document.body.appendChild(e),r=getComputedStyle(e,"").getPropertyValue("display"),e.parentNode.removeChild(e),"none"==r&&(r="block"),c[t]=r);return c[t]}(t.nodeName));return this},toggleClass:function(t,e,r){var i=this;return e.split(/\s+/g).forEach(function(e){void 0===r&&(r=!i.hasClass(t,e)),r?i.addClass(t,e):i.removeClass(t,e)}),i}}),t.styler=h}),t("skylark-utils/dnd",["./skylark","./langx","./noder","./datax","./finder","./geom","./eventer","./styler"],function(t,e,r,i,n,s,a,o){a.on,a.off,i.attr,i.removeAttr,s.pagePosition,o.addClass,s.height;var u=e.Evented.inherit({klassName:"DndManager",init:function(){},prepare:function(t){var e=a.create("preparing",{dragSource:t.dragSource,dragHandle:t.dragHandle});t.trigger(e),t.dragSource=e.dragSource},start:function(t,r){var i=s.pagePosition(t.dragSource);this.draggingOffsetX=parseInt(r.pageX-i.left),this.draggingOffsetY=parseInt(r.pageY-i.top);var n=a.create("started",{elm:t.elm,dragSource:t.dragSource,dragHandle:t.dragHandle,ghost:null,transfer:{}});t.trigger(n),this.dragging=t,t.draggingClass&&o.addClass(t.dragSource,t.draggingClass),this.draggingGhost=n.ghost,this.draggingGhost||(this.draggingGhost=t.elm),this.draggingTransfer=n.transfer,this.draggingTransfer&&e.each(this.draggingTransfer,function(t,e){r.dataTransfer.setData(t,e)}),r.dataTransfer.setDragImage(this.draggingGhost,this.draggingOffsetX,this.draggingOffsetY),r.dataTransfer.effectAllowed="copyMove";var u=a.create("dndStarted",{elm:n.elm,dragSource:n.dragSource,dragHandle:n.dragHandle,ghost:n.ghost,transfer:n.transfer});this.trigger(u)},over:function(){},end:function(t){var e=this.dragging;e&&e.draggingClass&&o.removeClass(e.dragSource,e.draggingClass);var r=a.create("dndEnded",{});this.trigger(r),this.dragging=null,this.draggingTransfer=null,this.draggingGhost=null,this.draggingOffsetX=null,this.draggingOffsetY=null}}),l=new u,c=e.Evented.inherit({klassName:"Draggable",init:function(t,r){var s=this;s.elm=t,s.draggingClass=r.draggingClass||"dragging",s.params=e.clone(r),["preparing","started","ended","moving"].forEach(function(t){e.isFunction(r[t])&&s.on(t,r[t])}),a.on(t,{mousedown:function(t){var e=s.params;e.handle&&(s.dragHandle=n.closest(t.target,e.handle),!s.dragHandle)||(e.source?s.dragSource=n.closest(t.target,e.source):s.dragSource=s.elm,l.prepare(s),s.dragSource&&i.attr(s.dragSource,"draggable","true"))},mouseup:function(t){s.dragSource&&(s.dragSource=null,s.dragHandle=null)},dragstart:function(t){i.attr(s.dragSource,"draggable","false"),l.start(s,t)},dragend:function(t){a.stop(t),l.dragging&&l.end(!1)}})}}),h=e.Evented.inherit({klassName:"Droppable",init:function(t,r){var i,n,s=this,u=(r.draggingClass,!0);s.elm=t,s._params=r,["started","entered","leaved","dropped","overing"].forEach(function(t){e.isFunction(r[t])&&s.on(t,r[t])}),a.on(t,{dragover:function(t){if(t.stopPropagation(),u){var e=a.create("overing",{overElm:t.target,transfer:l.draggingTransfer,acceptable:!0});s.trigger(e),e.acceptable&&(t.preventDefault(),t.dataTransfer.dropEffect="copyMove")}},dragenter:function(t){s._params;var e=s.elm,r=a.create("entered",{transfer:l.draggingTransfer});s.trigger(r),t.stopPropagation(),i&&u&&o.addClass(e,i)},dragleave:function(t){s._params;var e=s.elm;if(!u)return!1;var r=a.create("leaved",{transfer:l.draggingTransfer});s.trigger(r),t.stopPropagation(),i&&u&&o.removeClass(e,i)},drop:function(t){s._params;var e=s.elm;if(a.stop(t),l.dragging){i&&u&&o.addClass(e,i);var r=a.create("dropped",{transfer:l.draggingTransfer});s.trigger(r),l.end(!0)}}}),l.on("dndStarted",function(e){var r=a.create("started",{transfer:l.draggingTransfer,acceptable:!1});s.trigger(r),u=r.acceptable,i=r.hoverClass,(n=r.activeClass)&&u&&o.addClass(t,n)}).on("dndEnded",function(e){var r=a.create("ended",{transfer:l.draggingTransfer,acceptable:!1});s.trigger(r),i&&u&&o.removeClass(t,i),n&&u&&o.removeClass(t,n),u=!1,n=null,i=null})}});function d(){return d}return e.mixin(d,{draggable:function(t,e){return new c(t,e)},droppable:function(t,e){return new h(t,e)},manager:l}),t.dnd=d}),t("skylark-utils/_devices/usermedia",["../langx"],function(t){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var e=t.Deferred,r=null;function i(){return i}return t.mixin(i,{isSupported:function(){return!!navigator.getUserMedia},start:function(t,i){var n=new e;return navigator.getUserMedia({video:!0,audio:!0},function(e){r=e,t.src=window.URL.createObjectURL(localMediaStream),t.onloadedmetadata=function(t){},n.resolve()},function(t){n.reject(t)}),n.promise},stop:function(){r&&(r.stop(),r=null)}}),i}),t("skylark-utils/_devices/vibrate",["../langx"],function(t){function e(){return e}return navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,t.mixin(e,{isSupported:function(){return!!navigator.vibrate},start:function(t){navigator.vibrate(t)},stop:function(){navigator.vibrate(0)}}),e}),t("skylark-utils/devices",["./skylark","./langx","./_devices/usermedia","./_devices/vibrate"],function(t,e,r,i){function n(){return n}return e.mixin(n,{usermedia:r,vibrate:i}),t.devices=n}),t("skylark-utils/filer",["skylark-utils-filer/filer"],function(t){return t}),t("skylark-utils/fx",["skylark-utils-dom/fx"],function(t){return t}),t("skylark-utils/images",["skylark-utils-dom/images"],function(t){return t}),t("skylark-utils/models",["./skylark","./langx"],function(t,e){var r={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"},i=e.Stateful.inherit({sync:function(){return u.sync.apply(this,arguments)},matches:function(t){return e.isMatch(this.attributes,t)},fetch:function(t){var r=this,i=(t=e.mixin({parse:!0},t)).success;return t.success=function(e){var n=t.parse?r.parse(e,t):e;if(!r.set(n,t))return!1;i&&i.call(t.context,r,e,t),r.trigger("sync",r,e,t)},wrapError(this,t),this.sync("read",this,t)},save:function(t,r,i){var n;null==t||"object"==typeof t?(n=t,i=r):(n={})[t]=r;var s=(i=e.mixin({validate:!0,parse:!0},i)).wait;if(n&&!s){if(!this.set(n,i))return!1}else if(!this._validate(n,i))return!1;var a=this,o=i.success,u=this.attributes;i.success=function(t){a.attributes=u;var r=i.parse?a.parse(t,i):t;if(s&&(r=e.mixin({},n,r)),r&&!a.set(r,i))return!1;o&&o.call(i.context,a,t,i),a.trigger("sync",a,t,i)},wrapError(this,i),n&&s&&(this.attributes=e.mixin({},u,n));var l=this.isNew()?"create":i.patch?"patch":"update";"patch"!==l||i.attrs||(i.attrs=n);var c=this.sync(l,this,i);return this.attributes=u,c},destroy:function(t){var r=this,i=(t=t?e.clone(t):{}).success,n=t.wait,s=function(){r.stopListening(),r.trigger("destroy",r,r.collection,t)};t.success=function(e){n&&s(),i&&i.call(t.context,r,e,t),r.isNew()||r.trigger("sync",r,e,t)};var a=!1;return this.isNew()?e.defer(t.success):(wrapError(this,t),a=this.sync("delete",this,t)),n||s(),a},url:function(){var t=e.result(this,"urlRoot")||e.result(this.collection,"url")||urlError();if(this.isNew())return t;var r=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(r)},parse:function(t,e){return t}}),n=e.Evented.inherit({init:function(t,r){r||(r={}),r.entity&&(this.entity=r.entity),void 0!==r.comparator&&(this.comparator=r.comparator),this._reset(),t&&this.reset(t,e.mixin({silent:!0},r))}}),s={add:!0,remove:!0,merge:!0},a={add:!0,remove:!1},o=function(t,e,r){r=Math.min(Math.max(r,0),t.length);var i,n=Array(t.length-r),s=e.length;for(i=0;i<n.length;i++)n[i]=t[i+r];for(i=0;i<s;i++)t[i+r]=e[i];for(i=0;i<n.length;i++)t[i+s+r]=n[i]};function u(){return u}return n.partial({entity:i,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return u.sync.apply(this,arguments)},add:function(t,r){return this.set(t,e.mixin({merge:!1},r,a))},remove:function(t,r){r=e.mixin({},r);var i=!e.isArray(t);t=i?[t]:t.slice();var n=this._removeEntitys(t,r);return!r.silent&&n.length&&(r.changes={added:[],merged:[],removed:n},this.trigger("update",this,r)),i?n[0]:n},set:function(t,r){if(null!=t){(r=e.mixin({},s,r)).parse&&!this._isEntity(t)&&(t=this.parse(t,r)||[]);var i=!e.isArray(t);t=i?[t]:t.slice();var n=r.at;null!=n&&(n=+n),n>this.length&&(n=this.length),n<0&&(n+=this.length+1);var a,u,l=[],c=[],h=[],d=[],g={},f=r.add,p=r.merge,v=r.remove,m=!1,y=this.comparator&&null==n&&!1!==r.sort,_=e.isString(this.comparator)?this.comparator:null;for(u=0;u<t.length;u++){a=t[u];var k=this.get(a);if(k){if(p&&a!==k){var E=this._isEntity(a)?a.attributes:a;r.parse&&(E=k.parse(E,r)),k.set(E,r),h.push(k),y&&!m&&(m=k.hasChanged(_))}g[k.cid]||(g[k.cid]=!0,l.push(k)),t[u]=k}else f&&(a=t[u]=this._prepareEntity(a,r))&&(c.push(a),this._addReference(a,r),g[a.cid]=!0,l.push(a))}if(v){for(u=0;u<this.length;u++)a=this.entities[u],g[a.cid]||d.push(a);d.length&&this._removeEntitys(d,r)}var b=!1,x=!y&&f&&v;if(l.length&&x?(b=this.length!==l.length||this.entities.some(function(t,e){return t!==l[e]}),this.entities.length=0,o(this.entities,l,0),this.length=this.entities.length):c.length&&(y&&(m=!0),o(this.entities,c,null==n?this.length:n),this.length=this.entities.length),m&&this.sort({silent:!0}),!r.silent){for(u=0;u<c.length;u++)null!=n&&(r.index=n+u),(a=c[u]).trigger("add",a,this,r);(m||b)&&this.trigger("sort",this,r),(c.length||d.length||h.length)&&(r.changes={added:c,removed:d,merged:h},this.trigger("update",this,r))}return i?t[0]:t}},reset:function(t,r){r=r?e.clone(r):{};for(var i=0;i<this.entities.length;i++)this._removeReference(this.entities[i],r);return r.previousEntitys=this.entities,this._reset(),t=this.add(t,e.mixin({silent:!0},r)),r.silent||this.trigger("reset",this,r),t},push:function(t,r){return this.add(t,e.mixin({at:this.length},r))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,r){return this.add(t,e.mixin({at:0},r))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return slice.apply(this.entities,arguments)},get:function(t){if(null!=t)return this._byId[t]||this._byId[this.entityId(t.attributes||t)]||t.cid&&this._byId[t.cid]},has:function(t){return null!=this.get(t)},at:function(t){return t<0&&(t+=this.length),this.entities[t]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,!0)},sort:function(t){var r=this.comparator;if(!r)throw new Error("Cannot sort a set without a comparator");t||(t={});var i=r.length;return e.isFunction(r)&&(r=e.proxy(r,this)),1===i||e.isString(r)?this.entities=this.sortBy(r):this.entities.sort(r),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return this.map(t+"")},fetch:function(t){var r=(t=e.mixin({parse:!0},t)).success,i=this;return t.success=function(e){var n=t.reset?"reset":"set";i[n](e,t),r&&r.call(t.context,i,e,t),i.trigger("sync",i,e,t)},wrapError(this,t),this.sync("read",this,t)},create:function(t,r){var i=(r=r?e.clone(r):{}).wait;if(!(t=this._prepareEntity(t,r)))return!1;i||this.add(t,r);var n=this,s=r.success;return r.success=function(t,e,r){i&&n.add(t,r),s&&s.call(r.context,t,e,r)},t.save(null,r),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.entities,{entity:this.entity,comparator:this.comparator})},entityId:function(t){return t[this.entity.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.entities=[],this._byId={}},_prepareEntity:function(t,r){if(this._isEntity(t))return t.collection||(t.collection=this),t;(r=r?e.clone(r):{}).collection=this;var i=new this.entity(t,r);return i.validationError?(this.trigger("invalid",this,i.validationError,r),!1):i},_removeEntitys:function(t,e){for(var r=[],i=0;i<t.length;i++){var n=this.get(t[i]);if(n){var s=this.indexOf(n);this.entities.splice(s,1),this.length--,delete this._byId[n.cid];var a=this.entityId(n.attributes);null!=a&&delete this._byId[a],e.silent||(e.index=s,n.trigger("remove",n,this,e)),r.push(n),this._removeReference(n,e)}}return r},_isEntity:function(t){return t instanceof i},_addReference:function(t,e){this._byId[t.cid]=t;var r=this.entityId(t.attributes);null!=r&&(this._byId[r]=t),t.on("all",this._onEntityEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var r=this.entityId(t.attributes);null!=r&&delete this._byId[r],this===t.collection&&delete t.collection,t.off("all",this._onEntityEvent,this)},_onEntityEvent:function(t,e,r,i){if(e){if(("add"===t||"remove"===t)&&r!==this)return;if("destroy"===t&&this.remove(e,i),"change"===t){var n=this.entityId(e.previousAttributes()),s=this.entityId(e.attributes);n!==s&&(null!=n&&delete this._byId[n],null!=s&&(this._byId[s]=e))}}this.trigger.apply(this,arguments)}}),e.mixin(u,{emulateHTTP:!1,emulateJSON:!1,sync:function(t,i,n){var s=r[t];e.defaults(n||(n={}),{emulateHTTP:u.emulateHTTP,emulateJSON:u.emulateJSON});var a={type:s,dataType:"json"};n.url||(a.url=e.result(i,"url")||urlError());null!=n.data||!i||"create"!==t&&"update"!==t&&"patch"!==t||(a.contentType="application/json",a.data=JSON.stringify(n.attrs||i.toJSON(n)));n.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{entity:a.data}:{});if(n.emulateHTTP&&("PUT"===s||"DELETE"===s||"PATCH"===s)){a.type="POST",n.emulateJSON&&(a.data._method=s);var o=n.beforeSend;n.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",s),o)return o.apply(this,arguments)}}"GET"===a.type||n.emulateJSON||(a.processData=!1);var l=n.error;n.error=function(t,e,r){n.textStatus=e,n.errorThrown=r,l&&l.call(n.context,t,e,r)};var c=n.xhr=e.Xhr.request(e.mixin(a,n));return i.trigger("request",i,c,n),c},Entity:i,Collection:n}),t.models=u}),t("skylark-utils/query",["skylark-utils-dom/query"],function(t){return t}),t("skylark-utils/scripter",["skylark-utils-dom/scripter"],function(t){return t}),t("skylark-utils/storages",["skylark-utils-storage"],function(t){return t}),t("skylark-utils/touchx",[],function(){var t=function(){function t(){this._dropEffect="move",this._effectAllowed="all",this._data={}}return Object.defineProperty(t.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(t){this._dropEffect=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"effectAllowed",{get:function(){return this._effectAllowed},set:function(t){this._effectAllowed=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"types",{get:function(){return Object.keys(this._data)},enumerable:!0,configurable:!0}),t.prototype.clearData=function(t){null!=t?delete this._data[t]:this._data=null},t.prototype.getData=function(t){return this._data[t]||""},t.prototype.setData=function(t,e){this._data[t]=e},t.prototype.setDragImage=function(t,r,i){var n=e._instance;n._imgCustom=t,n._imgOffset={x:r,y:i}},t}(),e=function(){function e(){if(this._lastClick=0,e._instance)throw"DragDropTouch instance already created.";var t=!1;if(document.addEventListener("test",null,{get passive(){return t=!0,!0}}),"ontouchstart"in document){var r=document,i=this._touchstart.bind(this),n=this._touchmove.bind(this),s=this._touchend.bind(this),a=!!t&&{passive:!1,capture:!1};r.addEventListener("touchstart",i,a),r.addEventListener("touchmove",n,a),r.addEventListener("touchend",s),r.addEventListener("touchcancel",s)}}return e.getInstance=function(){return e._instance},e.prototype._touchstart=function(t){var r=this;if(this._shouldHandle(t)){if(Date.now()-this._lastClick<e._DBLCLICK&&this._dispatchEvent(t,"dblclick",t.target))return t.preventDefault(),void this._reset();this._reset();var i=this._closestDraggable(t.target);i&&(this._dispatchEvent(t,"mousemove",t.target)||this._dispatchEvent(t,"mousedown",t.target)||(this._dragSource=i,this._ptDown=this._getPoint(t),this._lastTouch=t,t.preventDefault(),setTimeout(function(){r._dragSource==i&&null==r._img&&r._dispatchEvent(t,"contextmenu",i)&&r._reset()},e._CTXMENU)))}},e.prototype._touchmove=function(t){if(this._shouldHandle(t)){var r=this._getTarget(t);if(this._dispatchEvent(t,"mousemove",r))return this._lastTouch=t,void t.preventDefault();if(this._dragSource&&!this._img){var i=this._getDelta(t);i>e._THRESHOLD&&(this._dispatchEvent(t,"dragstart",this._dragSource),this._createImage(t),this._dispatchEvent(t,"dragenter",r))}this._img&&(this._lastTouch=t,t.preventDefault(),r!=this._lastTarget&&(this._dispatchEvent(this._lastTouch,"dragleave",this._lastTarget),this._dispatchEvent(t,"dragenter",r),this._lastTarget=r),this._moveImage(t),this._dispatchEvent(t,"dragover",r))}},e.prototype._touchend=function(t){if(this._shouldHandle(t)){if(this._dispatchEvent(this._lastTouch,"mouseup",t.target))return void t.preventDefault();this._img||(this._dragSource=null,this._dispatchEvent(this._lastTouch,"click",t.target),this._lastClick=Date.now()),this._destroyImage(),this._dragSource&&(t.type.indexOf("cancel")<0&&this._dispatchEvent(this._lastTouch,"drop",this._lastTarget),this._dispatchEvent(this._lastTouch,"dragend",this._dragSource),this._reset())}},e.prototype._shouldHandle=function(t){return t&&!t.defaultPrevented&&t.touches&&t.touches.length<2},e.prototype._reset=function(){this._destroyImage(),this._dragSource=null,this._lastTouch=null,this._lastTarget=null,this._ptDown=null,this._dataTransfer=new t},e.prototype._getPoint=function(t,e){return t&&t.touches&&(t=t.touches[0]),{x:e?t.pageX:t.clientX,y:e?t.pageY:t.clientY}},e.prototype._getDelta=function(t){var e=this._getPoint(t);return Math.abs(e.x-this._ptDown.x)+Math.abs(e.y-this._ptDown.y)},e.prototype._getTarget=function(t){for(var e=this._getPoint(t),r=document.elementFromPoint(e.x,e.y);r&&"none"==getComputedStyle(r).pointerEvents;)r=r.parentElement;return r},e.prototype._createImage=function(t){this._img&&this._destroyImage();var r=this._imgCustom||this._dragSource;if(this._img=r.cloneNode(!0),this._copyStyle(r,this._img),this._img.style.top=this._img.style.left="-9999px",!this._imgCustom){var i=r.getBoundingClientRect(),n=this._getPoint(t);this._imgOffset={x:n.x-i.left,y:n.y-i.top},this._img.style.opacity=e._OPACITY.toString()}this._moveImage(t),document.body.appendChild(this._img)},e.prototype._destroyImage=function(){this._img&&this._img.parentElement&&this._img.parentElement.removeChild(this._img),this._img=null,this._imgCustom=null},e.prototype._moveImage=function(t){var e=this;this._img&&requestAnimationFrame(function(){var r=e._getPoint(t,!0),i=e._img.style;i.position="absolute",i.pointerEvents="none",i.zIndex="999999",i.left=Math.round(r.x-e._imgOffset.x)+"px",i.top=Math.round(r.y-e._imgOffset.y)+"px"})},e.prototype._copyProps=function(t,e,r){for(var i=0;i<r.length;i++){var n=r[i];t[n]=e[n]}},e.prototype._copyStyle=function(t,r){if(e._rmvAtts.forEach(function(t){r.removeAttribute(t)}),t instanceof HTMLCanvasElement){var i=t,n=r;n.width=i.width,n.height=i.height,n.getContext("2d").drawImage(i,0,0)}for(var s=getComputedStyle(t),a=0;a<s.length;a++){var o=s[a];o.indexOf("transition")<0&&(r.style[o]=s[o])}r.style.pointerEvents="none";for(var a=0;a<t.children.length;a++)this._copyStyle(t.children[a],r.children[a])},e.prototype._dispatchEvent=function(t,r,i){if(t&&i){var n=document.createEvent("Event"),s=t.touches?t.touches[0]:t;return n.initEvent(r,!0,!0),n.button=0,n.which=n.buttons=1,this._copyProps(n,t,e._kbdProps),this._copyProps(n,s,e._ptProps),n.dataTransfer=this._dataTransfer,i.dispatchEvent(n),n.defaultPrevented}return!1},e.prototype._closestDraggable=function(t){for(;t;t=t.parentElement)if(t.hasAttribute("draggable")&&t.draggable)return t;return null},e}();return e._instance=new e,e._THRESHOLD=5,e._OPACITY=.5,e._DBLCLICK=500,e._CTXMENU=900,e._rmvAtts="id,class,style,draggable".split(","),e._kbdProps="altKey,ctrlKey,metaKey,shiftKey".split(","),e._ptProps="pageX,pageY,clientX,clientY,screenX,screenY".split(","),e}),t("skylark-utils/transforms",["skylark-utils-dom/transforms"],function(t){return t}),t("skylark-utils/elmx",["skylark-utils-dom/elmx"],function(t){return t}),t("skylark-utils/widgets",["./skylark","./langx","./noder","./datax","./styler","./geom","./eventer","./query","./elmx"],function(t,e,r,i,n,s,a,o,u){function l(){return l}var c=e.Evented.inherit({init:function(t,r){if(e.isHtmlNode(r)){var r=t;t=r}e.isHtmlNode(t)?this.el=t:this.el=null,r&&e.mixin(this,r),this.cid||(this.cid=e.uniqueId("w")),this._ensureElement()},tagName:"div",$:function(t){return this.$el.find(t)},render:function(){return this},remove:function(){return this._removeElement(),this.unlistenTo(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=l.$(t),this.el=this.$el[0]},delegateEvents:function(t){if(t||(t=e.result(this,"events")),!t)return this;for(var r in this.undelegateEvents(),t){var i=t[r];if(e.isFunction(i)||(i=this[i]),i){var n=r.match(delegateEventSplitter);this.delegate(n[1],n[2],e.proxy(i,this))}}return this},delegate:function(t,e,r){return this.$el.on(t+".delegateEvents"+this.uid,e,r),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.uid),this},undelegate:function(t,e,r){return this.$el.off(t+".delegateEvents"+this.uid,e,r),this},_createElement:function(t,e){return r.createElement(t,e)},_ensureElement:function(){if(this.el)this.setElement(e.result(this,"el"));else{var t=e.mixin({},e.result(this,"attributes"));this.id&&(t.id=e.result(this,"id")),this.className&&(t.class=e.result(this,"className")),this.setElement(this._createElement(e.result(this,"tagName"),t)),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)},i18n:function(t,r){return t=this.messages&&this.messages[t]||t.toString(),r&&e.each(r,function(e,r){t=t.replace("{"+e+"}",r)}),t}});return e.mixin(l,{$:o,define:function(t,e,r){},Widget:c}),t.widgets=l}),t("skylark-utils/main",["./skylark","./browser","./css","./datax","./dnd","./devices","./eventer","./filer","./finder","./fx","./geom","./images","./models","./noder","./query","./scripter","./storages","./styler","./touchx","./transforms","./langx","./elmx","./widgets"],function(t){return t}),t("skylark-utils",["skylark-utils/main"],function(t){return t})}(r),!n){var o=i("skylark-langx/skylark");s?module.exports=o:e.skylarkjs=o}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-utils.js.map
