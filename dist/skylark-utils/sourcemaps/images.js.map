{"version":3,"sources":["images.js"],"names":["define","skylark","langx","noder","geom","styler","datax","transforms","$","viewer","el","options","onload","css","img","top","clientSize","height","offsetHeight","left","width","offsetWidth","reset","visibility","loadedCallback","onerror","_init","style","position","Image","border","padding","margin","append","url","_load","src","_dispose","remove","loaded","failered","ret","load","dispose","forEach","name","args","makeArray","arguments","unshift","apply","images","elementNodeTypes","1","9","11","ImagesLoaded","Evented","inherit","init","elem","onAlways","this","document","querySelectorAll","elements","mixin","on","getImages","setTimeout","check","bind","addElementImages","nodeName","addImage","background","addElementBackgroundImages","nodeType","childImgs","i","length","children","child","getComputedStyle","reURL","matches","exec","backgroundImage","addBackground","loadingImage","LoadingImage","push","Background","onProgress","e","_this","progress","progressedCount","hasAnyBroken","one","complete","isLoaded","trigger","createEvent","element","message","debug","console","log","target","eventName","isComplete","getIsImageComplete","confirm","naturalWidth","proxyImage","addEventListener","undefined","handleEvent","event","method","type","unbindEvents","removeEventListener","fn","imagesLoaded","callback","inst","d","Deferred","resolve","reject","promise","ImageTrans"],"mappings":"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","file":"../images.js","sourcesContent":["define([\r\n    \"./skylark\",\r\n    \"./langx\",\r\n    \"./noder\",\r\n    \"./geom\",\r\n    \"./styler\",\r\n    \"./datax\",\r\n    \"./transforms\",\r\n    \"./query\"\r\n], function(skylark,langx,noder,geom,styler,datax,transforms,$) {\r\n\r\n  var elementNodeTypes = {\r\n    1: true,\r\n    9: true,\r\n    11: true\r\n  };\r\n\r\n  var ImagesLoaded = langx.Evented.inherit({\r\n  /**\r\n   * @param {Array, Element, NodeList, String} elem\r\n   * @param {Object or Function} options - if function, use as callback\r\n   * @param {Function} onAlways - callback function\r\n   */\r\n    init : function(elem, options, onAlways) {\r\n      // coerce ImagesLoaded() without new, to be new ImagesLoaded()\r\n      if ( !( this instanceof ImagesLoaded ) ) {\r\n        return new ImagesLoaded( elem, options, onAlways );\r\n      }\r\n      // use elem as selector string\r\n      if ( typeof elem == 'string' ) {\r\n        elem = document.querySelectorAll( elem );\r\n      }\r\n\r\n      this.elements = langx.makeArray( elem );\r\n      this.options = langx.mixin( {}, this.options );\r\n\r\n      if ( typeof options == 'function' ) {\r\n        onAlways = options;\r\n      } else {\r\n        langx.mixin( this.options, options );\r\n      }\r\n\r\n      if ( onAlways ) {\r\n        this.on( 'always', onAlways );\r\n      }\r\n\r\n      this.getImages();\r\n\r\n     // HACK check async to allow time to bind listeners\r\n      setTimeout( function() {\r\n        this.check();\r\n      }.bind( this ));\r\n\r\n    },\r\n\r\n    options : {},\r\n\r\n    getImages : function() {\r\n      this.images = [];\r\n\r\n      // filter & find items if we have an item selector\r\n      this.elements.forEach( this.addElementImages, this );\r\n    },\r\n\r\n    /**\r\n     * @param {Node} element\r\n     */\r\n    addElementImages : function( elem ) {\r\n      // filter siblings\r\n      if ( elem.nodeName == 'IMG' ) {\r\n        this.addImage( elem );\r\n      }\r\n      // get background image on element\r\n      if ( this.options.background === true ) {\r\n        this.addElementBackgroundImages( elem );\r\n      }\r\n\r\n      // find children\r\n      // no non-element nodes, #143\r\n      var nodeType = elem.nodeType;\r\n      if ( !nodeType || !elementNodeTypes[ nodeType ] ) {\r\n        return;\r\n      }\r\n      var childImgs = elem.querySelectorAll('img');\r\n      // concat childElems to filterFound array\r\n      for ( var i=0; i < childImgs.length; i++ ) {\r\n        var img = childImgs[i];\r\n        this.addImage( img );\r\n      }\r\n\r\n      // get child background images\r\n      if ( typeof this.options.background == 'string' ) {\r\n        var children = elem.querySelectorAll( this.options.background );\r\n        for ( i=0; i < children.length; i++ ) {\r\n          var child = children[i];\r\n          this.addElementBackgroundImages( child );\r\n        }\r\n      }\r\n    },\r\n\r\n    addElementBackgroundImages : function( elem ) {\r\n      var style = getComputedStyle( elem );\r\n      if ( !style ) {\r\n        // Firefox returns null if in a hidden iframe https://bugzil.la/548397\r\n        return;\r\n      }\r\n      // get url inside url(\"...\")\r\n      var reURL = /url\\((['\"])?(.*?)\\1\\)/gi;\r\n      var matches = reURL.exec( style.backgroundImage );\r\n      while ( matches !== null ) {\r\n        var url = matches && matches[2];\r\n        if ( url ) {\r\n          this.addBackground( url, elem );\r\n        }\r\n        matches = reURL.exec( style.backgroundImage );\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @param {Image} img\r\n     */\r\n    addImage : function( img ) {\r\n      var loadingImage = new LoadingImage( img );\r\n      this.images.push( loadingImage );\r\n    },\r\n\r\n    addBackground : function( url, elem ) {\r\n      var background = new Background( url, elem );\r\n      this.images.push( background );\r\n    },\r\n\r\n    check : function() {\r\n      var _this = this;\r\n      this.progressedCount = 0;\r\n      this.hasAnyBroken = false;\r\n      // complete if no images\r\n      if ( !this.images.length ) {\r\n        this.complete();\r\n        return;\r\n      }\r\n\r\n      function onProgress( e ) {\r\n        // HACK - Chrome triggers event before object properties have changed. #83\r\n        setTimeout( function() {\r\n          _this.progress( e );\r\n        });\r\n      }\r\n\r\n      this.images.forEach( function( loadingImage ) {\r\n        loadingImage.one( 'progress', onProgress );\r\n        loadingImage.check();\r\n      });\r\n    },\r\n\r\n    progress : function( e ) {\r\n\r\n      this.progressedCount++;\r\n      this.hasAnyBroken = this.hasAnyBroken || !e.isLoaded;\r\n      // progress event\r\n      this.trigger( langx.createEvent('progress', {\r\n        img : e.img,\r\n        element : e.element,\r\n        message : e.message,\r\n        isLoaded : e.isLoaded\r\n      }));\r\n\r\n      // check if completed\r\n      if ( this.progressedCount == this.images.length ) {\r\n        this.complete();\r\n      }\r\n\r\n      if ( this.options.debug && console ) {\r\n        console.log( 'progress: ' + message, e.target, e.element );\r\n      }\r\n    },\r\n\r\n    complete : function() {\r\n      var eventName = this.hasAnyBroken ? 'fail' : 'done';\r\n      this.isComplete = true;\r\n      this.trigger( eventName);\r\n      this.trigger( 'always');\r\n\r\n    }\r\n\r\n  });\r\n \r\n\r\n  // --------------------------  -------------------------- //\r\n\r\n  var LoadingImage = langx.Evented.inherit({\r\n    init: function( img ) {\r\n      this.img = img;\r\n    },\r\n    check : function() {\r\n      // If complete is true and browser supports natural sizes,\r\n      // try to check for image status manually.\r\n      var isComplete = this.getIsImageComplete();\r\n      if ( isComplete ) {\r\n        // report based on naturalWidth\r\n        this.confirm( this.img.naturalWidth !== 0, 'naturalWidth' );\r\n        return;\r\n      }\r\n\r\n      // If none of the checks above matched, simulate loading on detached element.\r\n      this.proxyImage = new Image();\r\n      this.proxyImage.addEventListener( 'load', this );\r\n      this.proxyImage.addEventListener( 'error', this );\r\n      // bind to image as well for Firefox. #191\r\n      this.img.addEventListener( 'load', this );\r\n      this.img.addEventListener( 'error', this );\r\n      this.proxyImage.src = this.img.src;\r\n    },\r\n\r\n    getIsImageComplete : function() {\r\n      return this.img.complete && this.img.naturalWidth !== undefined;\r\n    },\r\n\r\n    confirm : function( isLoaded, message ) {\r\n      this.isLoaded = isLoaded;\r\n      this.trigger( langx.createEvent('progress', {\r\n        img : this.img, \r\n        element : this.img,\r\n        message : message ,\r\n        isLoaded : isLoaded\r\n      }));\r\n    },\r\n\r\n    // ----- events ----- //\r\n\r\n    // trigger specified handler for event type\r\n    handleEvent : function( event ) {\r\n      var method = 'on' + event.type;\r\n      if ( this[ method ] ) {\r\n        this[ method ]( event );\r\n      }\r\n    },\r\n\r\n    onload : function() {\r\n      this.confirm( true, 'onload' );\r\n      this.unbindEvents();\r\n    },\r\n\r\n    onerror : function() {\r\n      this.confirm( false, 'onerror' );\r\n      this.unbindEvents();\r\n    },\r\n\r\n    unbindEvents : function() {\r\n      this.proxyImage.removeEventListener( 'load', this );\r\n      this.proxyImage.removeEventListener( 'error', this );\r\n      this.img.removeEventListener( 'load', this );\r\n      this.img.removeEventListener( 'error', this );\r\n    },\r\n\r\n  });\r\n\r\n\r\n  // -------------------------- Background -------------------------- //\r\n  var Background = LoadingImage.inherit({\r\n\r\n    init : function( url, element ) {\r\n      this.url = url;\r\n      this.element = element;\r\n      this.img = new Image();\r\n    },\r\n\r\n    check : function() {\r\n      this.img.addEventListener( 'load', this );\r\n      this.img.addEventListener( 'error', this );\r\n      this.img.src = this.url;\r\n      // check if image is already complete\r\n      var isComplete = this.getIsImageComplete();\r\n      if ( isComplete ) {\r\n        this.confirm( this.img.naturalWidth !== 0, 'naturalWidth' );\r\n        this.unbindEvents();\r\n      }\r\n    },\r\n\r\n    unbindEvents : function() {\r\n      this.img.removeEventListener( 'load', this );\r\n      this.img.removeEventListener( 'error', this );\r\n    },\r\n\r\n    confirm : function( isLoaded, message ) {\r\n      this.isLoaded = isLoaded;\r\n      this.trigger( langx.createEvent('progress', {\r\n        img : this.img,\r\n        element : this.element, \r\n        message : message,\r\n        isLoaded : isLoaded \r\n      }));\r\n    }\r\n  });\r\n\r\n\r\n  $.fn.imagesLoaded = function( options, callback ) {\r\n      var inst = new ImagesLoaded( this, options, callback );\r\n\r\n      var d = new langx.Deferred();\r\n      \r\n      inst.on(\"progress\",function(e){\r\n        d.progress(e);\r\n      });\r\n\r\n      inst.on(\"done\",function(e){\r\n        d.resolve(e);\r\n      });\r\n\r\n      inst.on(\"fail\",function(e){\r\n        d.reject(e);\r\n      });\r\n\r\n      return d.promise;\r\n  };\r\n\r\n  function viewer(el,options) {\r\n    var img ,\r\n        style = {},\r\n        clientSize = geom.clientSize(el),\r\n        loadedCallback = options.loaded,\r\n        faileredCallback = options.failered;\r\n\r\n    function onload() {\r\n        styler.css(img,{//居中\r\n          top: (clientSize.height - img.offsetHeight) / 2 + \"px\",\r\n          left: (clientSize.width - img.offsetWidth) / 2 + \"px\"\r\n        });\r\n\r\n        transforms.reset(img);\r\n\r\n        styler.css(img,{\r\n          visibility: \"visible\"\r\n        });\r\n\r\n        if (loadedCallback) {\r\n          loadedCallback();\r\n        }\r\n    }\r\n\r\n    function onerror() {\r\n\r\n    }\r\n    function _init() {\r\n      style = styler.css(el,[\"position\",\"overflow\"]);\r\n      if (style.position != \"relative\" && style.position != \"absolute\") { \r\n        styler.css(el,\"position\", \"relative\" );\r\n      }\r\n      styler.css(el,\"overflow\", \"hidden\" );\r\n\r\n      img = new Image();\r\n\r\n      styler.css(img,{\r\n        position: \"absolute\",\r\n        border: 0, padding: 0, margin: 0, width: \"auto\", height: \"auto\",\r\n        visibility: \"hidden\"\r\n      });\r\n\r\n      img.onload = onload;\r\n      img.onerror = onerror;\r\n\r\n      noder.append(el,img);\r\n\r\n      if (options.url) {\r\n        _load(options.url);\r\n      }\r\n    }\r\n\r\n    function _load(url) {\r\n        img.style.visibility = \"hidden\";\r\n        img.src = url;\r\n    }\r\n\r\n    function _dispose() {\r\n        noder.remove(img);\r\n        styler.css(el,style);\r\n        img = img.onload = img.onerror = null;\r\n    }\r\n\r\n    _init();\r\n\r\n    var ret =  {\r\n      load : _load,\r\n      dispose : _dispose\r\n    };\r\n\r\n    [\"vertical\",\"horizontal\",\"rotate\",\"left\",\"right\",\"scale\",\"zoom\",\"zoomin\",\"zoomout\",\"reset\"].forEach(\r\n      function(name){\r\n        ret[name] = function() {\r\n          var args = langx.makeArray(arguments);\r\n          args.unshift(img);\r\n          transforms[name].apply(null,args);\r\n        }\r\n      }\r\n    );\r\n\r\n    return ret;\r\n  }\r\n\r\n\r\n  $.fn.ImageTrans = function (options) {\r\n    return new ImageTrans(this, options);\r\n\r\n   };\r\n\r\n  function images() {\r\n    return images;\r\n  }\r\n\r\n  langx.mixin(images, {\r\n    loaded : ImagesLoaded,\r\n\r\n    viewer : viewer\r\n  });\r\n\r\n  return skylark.images = images;\r\n});\r\n"]}